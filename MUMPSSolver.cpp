//====================================================================================================================================
// IMPLEMENTATION FILE: "setAnalysis"
//====================================================================================================================================
// Syntax      : MUMPSSolver(n, nz, *i, *j, *K, *F, sym, output)
//------------------------------------------------------------------------------------------------------------------------------------
// Purpose     : Computes the vector solution for K*x = F. 
//------------------------------------------------------------------------------------------------------------------------------------
// Input       : Coordinates : List of coordinate values                          [Nnodes,3]
//               Elements    : List of elements values                            [Nelems,3]
//               GaussPoints : List of Gauss Integration values                   [Ngauss,3]
//------------------------------------------------------------------------------------------------------------------------------------
// Output      : Coordinates : Cleaned up list of coordinate values               [0,0]
//               Elements    : Cleaned up list of element values                  [0,0]
//               GaussPoints : Cleaned up list of Gauss Integration values        [0,0]
//------------------------------------------------------------------------------------------------------------------------------------
// Folder      : 
//------------------------------------------------------------------------------------------------------------------------------------
// Description : <Frees model memory>
// Keywords    : <Free,Coordinates, Elements, GaussPoints>
// Version     : <>
//====================================================================================================================================
// Written by Danilo S. Kusanovic, December 2013
// Last revised by D.S Kusanovic.
//====================================================================================================================================

  #include "dmumps_c.h"

   void MUMPSSolver(int n, int nz, int* &i, int* &j, double* &K, double* &F, unsigned int sym, unsigned int output){

//------------------------------------------------------------------------------------------------------------------------------------
// INITIALIZES MUMPS SOLVER: 
//------------------------------------------------------------------------------------------------------------------------------------
     DMUMPS_STRUC_C id;
     int myid, ierr;

     myid   = 0;
     ierr   = 0;

   //Initialize a MUMPS instance
     id.par = 1; 
     id.sym = sym;
     id.job = JOB_INIT; 
     id.comm_fortran = USE_COMM_WORLD;//0;
     
     dmumps_c(&id);

//------------------------------------------------------------------------------------------------------------------------------------
// DEFINES THE PROBLEM ON THE HOST: 
//------------------------------------------------------------------------------------------------------------------------------------
     id.irn = i; 
     id.jcn = j;
     id.a   = K; 
     id.rhs = F;
     id.n   = n; 
     id.nz  = nz; 

   //No outputs
     if (output==0){
	//id.ICNTL(3) = 0;
        id.ICNTL(1)=-1; id.ICNTL(2)=-1; id.ICNTL(3)=-1; id.ICNTL(4)=0;
     }

     id.ICNTL(14) = 50;

  //Calling the MUMPS package:
    id.job = 6;
    dmumps_c(&id);

  //Terminate a MUMPS instance:
    id.job = JOB_END; 
    dmumps_c(&id); 
   // ierr = 0;

   }

//====================================================================================================================================
// EOF
//====================================================================================================================================

