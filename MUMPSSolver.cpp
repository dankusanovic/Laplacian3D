//====================================================================================================================================
// IMPLEMENTATION FILE: "setAnalysis"
//====================================================================================================================================
// Syntax      : MUMPSSolver(n, nz, *i, *j, *K, *F, sym, output)
//------------------------------------------------------------------------------------------------------------------------------------
// Purpose     : Computes the vector solution for K*x = F. 
//------------------------------------------------------------------------------------------------------------------------------------
// Input       : n           : Number of unknowns                                 [1,1]
//               nz          : Number of components in COO format                 [1,1]
//               i           : Row vector components                              [nz,1]
//               j           : Column vector components                           [nz,1]
//               K           : Stiffness matrix vector values                     [nz,1]
//               F           : Force vector values                                [n,1]
//------------------------------------------------------------------------------------------------------------------------------------
// Output      : F           : Solution vector values                             [n,1]
//------------------------------------------------------------------------------------------------------------------------------------
// Folder      : 
//------------------------------------------------------------------------------------------------------------------------------------
// Description : <Solves linear system>
// Keywords    : <solver,Mumps,configuration>
// Version     : <>
//====================================================================================================================================
// Written by Danilo S. Kusanovic, December 2013
// Last revised by D.S Kusanovic.
//====================================================================================================================================
 
  #include "dmumps_c.h"
  #include "MUMPSSolver.hh"

   void MUMPSSolver(int n, int nz, int* &i, int* &j, double* &K, double* &F, unsigned int sym, unsigned int output){

//------------------------------------------------------------------------------------------------------------------------------------
// INITIALIZES MUMPS SOLVER: 
//------------------------------------------------------------------------------------------------------------------------------------
     DMUMPS_STRUC_C id;

   //Initialize a MUMPS instance
     id.par = 1; 
     id.sym = sym;
     id.job = JOB_INIT; 
     id.comm_fortran = USE_COMM_WORLD;
     
     dmumps_c(&id);

//------------------------------------------------------------------------------------------------------------------------------------
// DEFINES THE PROBLEM ON THE HOST: 
//------------------------------------------------------------------------------------------------------------------------------------
     id.irn = i; 
     id.jcn = j;
     id.a   = K; 
     id.rhs = F;
     id.n   = n; 
     id.nz  = nz; 

   //No outputs Messages: Erros, warnings.
     id.ICNTL(1)  = 0; 
     id.ICNTL(2)  = 0; 
     id.ICNTL(3)  = 0; 
     id.ICNTL(4)  = 0;

   //Percentage increase in the estimated working space.
     id.ICNTL(14) = 50;

   //Calling the MUMPS package:
     id.job = 6;
     dmumps_c(&id);

   //Terminate a MUMPS instance:
     id.job = JOB_END; 
     dmumps_c(&id); 

   }

//====================================================================================================================================
// EOF
//====================================================================================================================================

